---
layout: archive
permalink: /year-archive/
title: "Blog posts"
author_profile: true
redirect_from:
- /wordpress/blog-posts/
- /tags/
---

{% include base_path %}
{% include group-by-array collection=site.posts field="tags" %}

<style>
  .tag-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 25px;
  }

  .tag-chip {
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    user-select: none;
    transition: all 0.2s;
    border: none;
    text-decoration: none;
    font-family: sans-serif;
  }

  /* Available Tags */
  .tag-avail {
    background-color: #f1f3f5;
    color: #495057;
    border: 1px solid #dee2e6;
  }

  .tag-avail:hover {
    background-color: #e9ecef;
    border-color: #ced4da;
  }

  /* Selected Tags */
  .tag-selected {
    background-color: #228be6;
    color: white;
    display: flex;
    align-items: center;
    border: 1px solid #1c7cd6;
  }

  .tag-selected:hover {
    background-color: #1c7cd6;
  }

  .tag-remove-icon {
    margin-left: 8px;
    font-weight: bold;
    font-size: 1.1em;
    line-height: 0.8;
  }

  .tags-label {
    font-weight: bold;
    margin-bottom: 8px;
    display: block;
    font-size: 0.85em;
    color: #868e96;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
</style>

<!-- Filter UI -->
<div id="blog-filter-ui">
  <!-- Row 1: Available Tags -->
  <div>
    <span class="tags-label">Filter by Topic</span>
    <div id="row-available" class="tag-container">
      {% for tag in group_names %}
      {% assign tag_slug = tag | slugify %}
      <button class="tag-chip tag-avail" data-slug="{{ tag_slug }}" data-label="{{ tag }}"
        onclick="addTag('{{ tag_slug }}')">
        {{ tag }}
      </button>
      {% endfor %}
    </div>
  </div>

  <!-- Row 2: Selected Tags -->
  <div id="filter-area" style="display: none;">
    <span class="tags-label">Active Filters</span>
    <div id="row-selected" class="tag-container">
      <!-- Selected tags injected here -->
    </div>
  </div>
</div>

<div id="posts-list">
  {% capture written_year %}'None'{% endcapture %}
  {% for post in site.posts %}
  {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
  {% if year != written_year %}
  <h2 id="{{ year | slugify }}" class="archive__subtitle year-header">{{ year }}</h2>
  {% capture written_year %}{{ year }}{% endcapture %}
  {% endif %}

  <div class="post-item-wrapper" data-tags="{% for t in post.tags %}{{ t | slugify }} {% endfor %}">
    {% include archive-single.html %}
  </div>
  {% endfor %}
</div>

<script type="application/json" id="blog-tags-data">
  [
    {% for tag in group_names %}
      { "slug": {{ tag | slugify | jsonify }}, "label": {{ tag | jsonify }} }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
</script>

<script>
  /* State: Array of selected tag slugs */
  var selectedSlugs = [];

  /* Data: All tags for lookup */
  var allTags = [];
  try {
    var tagDataEl = document.getElementById('blog-tags-data');
    if (tagDataEl) {
      allTags = JSON.parse(tagDataEl.textContent);
    }
  } catch (e) {
    console.error("Failed to parse blog tags", e);
  }

  function init() {
    var hash = window.location.hash.substring(1);
    if (hash) {
      try {
        hash = decodeURIComponent(hash);
        /* Supports comma separated: #tag1,tag2 */
        var parts = hash.split(',').filter(function (s) { return s.length > 0; });
        selectedSlugs = parts;
      } catch (e) { }
    } else {
      selectedSlugs = [];
    }

    render();
  }

  function addTag(slug) {
    if (selectedSlugs.indexOf(slug) === -1) {
      selectedSlugs.push(slug);
      updateState();
    }
  }

  function removeTag(slug) {
    selectedSlugs = selectedSlugs.filter(function (s) { return s !== slug; });
    updateState();
  }

  function updateState() {
    if (selectedSlugs.length > 0) {
      window.location.hash = selectedSlugs.join(',');
    } else {
      /* Clear hash cleanly */
      history.pushState("", document.title, window.location.pathname + window.location.search);
      /* Trigger render manually since pushState doesn't fire hashchange */
      render();
    }
  }

  function render() {
    var rowAvail = document.getElementById('row-available');
    var rowSel = document.getElementById('row-selected');
    var docFilterArea = document.getElementById('filter-area');
    var posts = document.querySelectorAll('.post-item-wrapper');
    var yearHeaders = document.querySelectorAll('.year-header');

    /* 1. Update Available Tags (Show/Hide) */
    var availBtns = rowAvail.querySelectorAll('button');
    availBtns.forEach(function (btn) {
      var s = btn.getAttribute('data-slug');
      if (selectedSlugs.indexOf(s) !== -1) {
        btn.style.display = 'none'; /* Move to selected */
      } else {
        btn.style.display = 'inline-block';
      }
    });

    /* 2. Render Selected Tags */
    rowSel.innerHTML = '';
    if (selectedSlugs.length > 0) {
      docFilterArea.style.display = 'block';

      selectedSlugs.forEach(function (slug) {
        /* Find label */
        var tObj = undefined;
        for (var i = 0; i < allTags.length; i++) {
          if (allTags[i].slug === slug) { tObj = allTags[i]; break; }
        }
        var label = tObj ? tObj.label : slug;

        var btn = document.createElement('button');
        btn.className = 'tag-chip tag-selected';
        btn.onclick = function () { removeTag(slug); };
        btn.innerHTML = label + ' <span class="tag-remove-icon">&times;</span>';
        rowSel.appendChild(btn);
      });

      /* Hide Year Headers when filtering */
      yearHeaders.forEach(function (h) { h.style.display = 'none'; });

    } else {
      docFilterArea.style.display = 'none';
      /* Show Year Headers when NOT filtering (default view) */
      yearHeaders.forEach(function (h) { h.style.display = 'block'; });
    }

    /* 3. Filter Posts */
    posts.forEach(function (p) {
      if (selectedSlugs.length === 0) {
        p.style.display = 'block'; /* Default: show all when no filter */
        return;
      }

      var pTagsRaw = p.getAttribute('data-tags') || "";
      var pTags = pTagsRaw.split(' ');

      /* Logic: Show if post matches ANY selected tag (Union) */
      var match = false;
      for (var i = 0; i < selectedSlugs.length; i++) {
        if (pTags.indexOf(selectedSlugs[i]) !== -1) {
          match = true;
          break;
        }
      }

      if (match) {
        p.style.display = 'block';
      } else {
        p.style.display = 'none';
      }
    });
  }

  document.addEventListener("DOMContentLoaded", init);
  window.addEventListener('hashchange', init);
</script>